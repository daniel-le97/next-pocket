(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[997],{97417:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/DirectMessages/[id]",function(){return s(59614)}])},12997:function(e,t,s){"use strict";var r=s(85893),a=s(67294),n=s(50828),i=s(11163),l=s(79790),c=s(50229),o=s(85699),d=s(19524),u=s(37066),x=s(89583);let h=()=>{var e;let t=null===(e=c.a.friends)||void 0===e?void 0:e.filter(e=>"accepted"===e.status),s=c.a.user,n=(0,i.useRouter)(),u=()=>{n.push("/DirectMessages")};return(0,a.useEffect)(()=>{let e,t;return(async()=>{try{if(!s)return;await o._Q.getUserFriendsList(),e=await o._Q.subscribe(),t=await o._A.subscribeDM()}catch(e){l.Z.error(e)}})(),()=>{let s=null==e?void 0:e(),r=null==t?void 0:t();s&&console.log("unsubbed from friends records"),r&&console.log("unsubbed from dm status")}},[]),(0,r.jsxs)("div",{className:"friends-bar",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"channel-block-text",onClick:()=>u(),children:(0,r.jsxs)("div",{className:"",children:[(0,r.jsx)(x.PZ_,{className:"inline-block mr-2"}),"Friends"]})}),(0,r.jsx)("div",{className:"channel-block",children:(0,r.jsx)("h5",{className:"channel-block-text",children:"Direct Messages"})}),(0,r.jsx)("div",{className:"px-3 ",children:t&&(null==t?void 0:t.map((e,t)=>(0,r.jsx)(m,{friendShip:e},t)))})]}),(0,r.jsx)(d.t,{user:s})]})},m=e=>{var t,s;let{friendShip:n}=e,[l,c]=(0,a.useState)(!1),o=(0,i.useRouter)();if(!n)return(0,r.jsx)("div",{children:"NO USER"});let d=()=>{o.push("/DirectMessages/".concat(n.id))};return(0,r.jsxs)("div",{onClick:d,className:"friendShip-container my-3 flex cursor-pointer gap-x-2 rounded-md p-2 transition-all duration-150 ease-in hover:bg-zinc-500 hover:bg-opacity-25  ",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:null===(t=n.friend)||void 0===t?void 0:t.avatarUrl,alt:"userIcon",width:40,className:"rounded-full shadow-md shadow-zinc-900"}),(0,r.jsx)("div",{className:"absolute left-11 top-10",children:n&&(0,r.jsx)(u.Z,{status:n.activityStatus})})]}),(0,r.jsx)("small",{className:" font-bold text-rose-600",children:null===(s=n.friend)||void 0===s?void 0:s.username})]})};t.Z=(0,n.Pi)(h)},59614:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return D}});var r=s(85893),a=s(9008),n=s.n(a),i=s(67294),l=s(11163),c=s(50229),o=s(50828),d=s(79790),u=s(12997),x=s(73560),h=s(85699),m=s(58533),g=s(62230),f=s(126),v=s(50184);let j=()=>{let e=(0,l.useRouter)(),t=e.query.id,s=c.a.directMessages.filter(e=>e.id!=t).map(e=>new g.eQ(e)),a=async()=>{console.log("CurrentPage:",c.a.page,"TotalPages:",c.a.totalPages),c.a.page++,console.log(t),await h.bK.getDirectMessages(t)};return(0,r.jsx)("div",{id:"scrollableDiv2",className:"flex h-full  flex-col-reverse overflow-auto pb-32 pt-6  ".concat(""!=c.a.messageQuery?"rounded-sm border-2 border-indigo-500 shadow-inner  ":" "),children:(0,r.jsx)(m.Z,{dataLength:s.length,next:a,className:"    flex flex-col-reverse pt-6 ",inverse:!0,hasMore:c.a.totalPages!=c.a.page,loader:(0,r.jsx)(v.Y,{}),scrollableTarget:"scrollableDiv2",children:s.map((e,t)=>{let a=new Date(e.created).toLocaleDateString(),n=new Date(Date.now()).toLocaleDateString(),i=t>0?new Date(s[t-1].created).toLocaleDateString():null;return(0,r.jsxs)("div",{children:[(0,r.jsx)(f.Z,{message:e,index:t}),(0,r.jsx)("div",{children:a!==i&&a!==n&&(0,r.jsxs)("div",{className:"new-date",children:[(0,r.jsx)("hr",{className:"w-3/6  opacity-40"}),(0,r.jsx)("div",{className:" new-date-text",children:a}),(0,r.jsx)("hr",{className:"w-3/6  opacity-40"})]})})]},t)})})})};var b=(0,o.Pi)(j),p=s(89583),w=s(87536);let y=()=>{var e,t;let s=(0,l.useRouter)();null===(e=s.query.id)||void 0===e||e.toString();let[a,n]=(0,i.useState)(0),[o,u]=(0,i.useState)(""),[x,m]=(0,i.useState)(""),[g,f]=(0,i.useState)(-1),[v,j]=(0,i.useState)(-1),{register:b,handleSubmit:y,reset:N,setValue:k}=(0,w.cI)({defaultValues:{content:"",sender:null===(t=c.a.user)||void 0===t?void 0:t.id,files:"",friendRecord:c.a.dmRouterQuery}}),D=async e=>{try{k("friendRecord",c.a.dmRouterQuery),console.log(e),await h.bK.createDirectMessage(e),k("content","")}catch(e){d.Z.error(e)}};return(0,r.jsx)("div",{className:" absolute  bottom-2  max-h-full w-full  bg-white   pt-10  dark:border-white/20 dark:bg-gray-800 md:border-t-0 md:border-transparent md:!bg-transparent ",children:(0,r.jsxs)("form",{onSubmit:y(D),className:"relative mx-4  flex",children:[(0,r.jsx)("textarea",{id:"createMessageInput",rows:1,className:"create-message-input max-h-96 w-full resize-none  rounded-xl  bg-gray-100 py-3.5 pl-4 pr-12 text-lg font-semibold text-gray-500  focus:outline-none dark:bg-zinc-600/90 dark:text-zinc-300",...b("content",{required:!0,maxLength:1200,minLength:1}),onInput:e=>{e.currentTarget.style.height="auto",e.currentTarget.style.height="".concat(e.currentTarget.scrollHeight,"px"),n(e.currentTarget.value.length),a>=1200&&e.preventDefault()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y(D)())},onSelect:e=>{let t=e.target.value.slice(e.target.selectionStart,e.target.selectionEnd);m(t),f(e.target.selectionStart),j(e.target.selectionEnd)}}),(0,r.jsxs)("div",{className:"my-2 flex justify-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>insertMarkdown("**","**"),children:(0,r.jsx)(p.PKR,{})}),(0,r.jsx)("button",{onClick:()=>insertMarkdown("*","*"),children:(0,r.jsx)(p.Mef,{})}),(0,r.jsx)("button",{onClick:()=>insertMarkdown("~~","~~"),children:(0,r.jsx)(p.zal,{})}),(0,r.jsx)("button",{onClick:handleInsertImage,children:(0,r.jsx)(p.H3h,{})})]}),(0,r.jsxs)("p",{id:"charLimit",className:" absolute bottom-14 right-2 text-sm  ".concat(a<=1200?"text-zinc-300":"text-red-400"),children:[a,"/1200"]}),(0,r.jsx)("button",{type:"submit",className:"btn-primary absolute bottom-2 right-2 ",children:"Submit"})]})})};var N=(0,o.Pi)(y);let k=()=>{let e=(0,l.useRouter)(),t=e.query.id,s=c.a.user;return(0,i.useEffect)(()=>{if(!s){e.push("/login");return}if(t){c.a.dmRouterQuery=e.query.id;let s=async()=>{try{if(!0==c.a.dmTracker[t])return;c.a.directMessages=c.a.directMessages.filter(e=>e.id!=t),c.a.dmTracker[t]=!0,c.a.page=1,await h.bK.getDirectMessages(t),await h._Q.getUserFriendsList()}catch(e){d.Z.error(e)}};s()}return()=>{c.a.dmTracker[t]=!1}},[e.query.id]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:"next-pocket"}),(0,r.jsx)("meta",{name:"description",content:"Generated by create-t3-app"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center ",children:(0,r.jsxs)("div",{className:"flex  h-screen   w-full ",children:[(0,r.jsx)(u.Z,{}),(0,r.jsxs)("div",{className:"message-container",children:[e.query.id&&(0,r.jsx)(b,{}),(0,r.jsx)(N,{})]})]})})]})};var D=(0,o.Pi)((0,x.Q)(k))},72770:function(e){"use strict";e.exports=next}},function(e){e.O(0,[284,71,186,184,774,888,179],function(){return e(e.s=97417)}),_N_E=e.O()}]);