(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[855],{11658:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/server/[id]",function(){return s(56220)}])},56220:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return A}});var a=s(85893),n=s(9008),r=s.n(n),l=s(19524),i=s(67294),c=s(11163),o=s(50828),d=s(79790),u=s(37066),x=s(63750),h=s(50229),m=s(85699),g=s(20128);let j=()=>{let e=h.a.members,[t,s]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e;return(async()=>{try{e=await m._A.subscribe()}catch(e){d.Z.error(e)}})(),()=>{null==e||e()}},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:t?"m-0  h-auto  w-64 overflow-hidden bg-gray-200 shadow-lg transition-all duration-300 dark:bg-zinc-800   ":" h-0 w-0 cursor-none overflow-hidden bg-zinc-800  opacity-0 transition-all duration-300 ",children:[(0,a.jsxs)("div",{className:"channel-block",children:[(0,a.jsx)("h5",{className:"channel-block-text",children:"Members"}),(0,a.jsxs)("div",{className:" mx-auto my-2 rounded-3xl  text-gray-500",children:[" ",t?(0,a.jsx)(x.PxJ,{size:24,onClick:()=>s(!t),className:"cursor-pointer"}):(0,a.jsx)("div",{className:""})]})]}),(0,a.jsx)("div",{className:" flex flex-col gap-y-3 px-3",children:e&&e.map((e,t)=>(0,a.jsx)("div",{className:"relative cursor-pointer rounded-lg p-2 transition-all duration-200 hover:bg-slate-500",children:(0,a.jsx)(p,{user:e})},t))})]}),!t&&(0,a.jsx)("div",{className:" absolute  right-3   top-2 mx-auto my-2 rounded-3xl   text-gray-500 transition-all duration-200",children:(0,a.jsx)(x.RVs,{size:24,onClick:()=>s(!t),className:"hover:text-green-500 cursor-pointer"})})]})},p=e=>{var t,s;let{user:n}=e;return(0,a.jsxs)("div",{className:"user-container flex gap-x-2  ",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.Z,{height:"h-8",width:"w-8",avatarUrl:null===(t=n.expand)||void 0===t?void 0:t.user.avatarUrl}),(0,a.jsx)("div",{className:"absolute left-8 top-9",children:n&&(0,a.jsx)(u.Z,{status:n.expand.user.expand.onlineStatus.status})})]}),(0,a.jsx)("small",{className:" font-bold text-rose-600",children:null===(s=n.expand)||void 0===s?void 0:s.user.username})]})};var v=(0,o.Pi)(j),f=s(48699),b=s(73560),y=s(89583),N=s(47472),w=s(44217),k=s(32483),S=s(68949),z=s(61528);let M=()=>{var e;return(0,a.jsxs)("div",{className:"top-navigation",children:[(0,a.jsx)(y.qc7,{size:"20",className:"title-hashtag"}),(0,a.jsx)("h5",{className:"channel-room-title",children:""===h.a.messageQuery?null===(e=h.a.activeChannel)||void 0===e?void 0:e.title:"Searching Messages Within Server"}),(0,a.jsx)(P,{})]})},P=()=>{let[e,t]=(0,i.useState)(""),[s,n]=(0,i.useState)(!0),r=(0,i.useMemo)(()=>async e=>{let t=await N.pb.collection(w.nW.Messages).getList(1,10,{filter:'content ~ "'.concat(e,'"'),expand:"user,likes(message).user"}),s=t.items;(0,S.aD)(()=>{let e=s.map((e,t)=>{let s=new k.v0(e);return h.a.messageLikes[t]=e.expand["likes(message)"]||[],s});h.a.messages=[...h.a.messages,...e],h.a.totalPages=t.totalPages})()},[]),l=t=>{t.preventDefault(),h.a.messageQuery=e,h.a.messages=[],h.a.page=1,r(e)};return(0,a.jsxs)("form",{onSubmit:l,className:" relative  flex      items-center   justify-start  gap-x-2      ",children:[(0,a.jsx)("input",{className:" pr-10 text-gray-300 transition-all   duration-700 focus:w-72  ".concat(s?"w-full":""),type:"text",placeholder:"Search",value:e,onChange:e=>t(e.target.value)}),(0,a.jsx)("div",{className:"absolute right-2 z-10 ",children:(0,a.jsx)(z.ZP,{content:"Search Message",color:"invert",placement:"bottom",children:(0,a.jsx)("button",{className:"m-0 pt-1 ",children:(0,a.jsx)(y.U41,{size:22,className:"     my-auto text-gray-500 hover:text-green-500 ".concat(""!==e?"text-green-500":"")})})})})]})};var C=(0,o.Pi)(M),U=s(50184),_=s(45445),Z=s(87536),E=s(39675);let T=()=>{let[e,t]=(0,i.useState)(!1);return(0,a.jsx)(E.Z,{buttonIcon:(0,a.jsx)(z.ZP,{content:"Messaging GuideLine",color:"invert",placement:"top",children:(0,a.jsx)(y.MXt,{size:18,className:"text-gray-300"})}),title:"Messaging Guidelines for using Markdown",children:(0,a.jsx)("div",{className:" p-2 text-gray-900 dark:text-gray-300 ",children:(0,a.jsxs)("ul",{className:"ml-4 list-disc",children:[(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"**text**"})," for bold text."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"_text_"})," for italic text."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"~~text~~"})," for strikethrough text."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"`code`"})," for inline code."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"``` code ```"})," for code blocks."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"#"})," for heading 1, ",(0,a.jsx)("code",{children:"##"})," for heading 2, and so on."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"-"})," or ",(0,a.jsx)("code",{children:"*"})," for unordered lists."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"1."})," or ",(0,a.jsx)("code",{children:"1)"})," for ordered lists."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"[text](url)"})," or ",(0,a.jsx)("code",{children:"<url>"})," for links."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:"![alt text](image url)"})," for images."]}),(0,a.jsxs)("li",{children:["Use ",(0,a.jsx)("code",{children:" [![](image url)](image url)"})," for Link images."]})]})})})};var I=(0,o.Pi)(T);let F=()=>{let[e,t]=(0,i.useState)(""),[s,n]=(0,i.useState)(-1),[r,l]=(0,i.useState)(-1),c=h.a.user,[o,u]=(0,i.useState)(0),[x,g]=(0,i.useState)([]),[j,p]=(0,i.useState)(""),[v,f]=(0,i.useState)([]),b=document.getElementById("createMessageInput"),{register:N,handleSubmit:w,reset:k,setValue:S}=(0,Z.cI)({defaultValues:{content:"",user:c.id,channel:"",files:"",attachments:""}}),M=async e=>{try{var t;e.content&&(e.content=e.content.replace(/(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp))(?=[^\s]*\s)/g,"![$1]($1)")),e.channel=null===(t=h.a.activeChannel)||void 0===t?void 0:t.id,console.log(e.content),await _.l.sendMessage(e,v),k(),b.style.height="initial",u(0),g([]),f([])}catch(e){d.Z.error(e)}};(0,i.useEffect)(()=>{e&&console.log(e)},[e]);let P=(t,a,i)=>{if(-1!==s&&-1!==r){let c=i.substring(0,s),o=i.substring(r),d=c+(t+e+a)+o;return n(-1),l(-1),i.includes(t)&&i.includes(a)&&(d=c+e+o),b.value=d,b.setSelectionRange(c.length,c.length+e.length),d}},C=async e=>{try{var t;await m.TQ.deleteFile(null===h.a||void 0===h.a?void 0:null===(t=h.a.user)||void 0===t?void 0:t.id,e),g([]),f([]),S("attachments","")}catch(e){d.Z.error(e)}},U=e=>{let t=async()=>{let t=await m.TQ.uploadFile(e.target.files),s=null==t?void 0:t.id;S("files",s),g([...x,null==t?void 0:t.url]),f([...v,t]),b.value=b.value+"![".concat(null==t?void 0:t.name,"](").concat(null==t?void 0:t.url,")")};t()};return(0,a.jsx)("div",{className:" absolute  bottom-2  max-h-full w-full  bg-white   pt-10  dark:border-white/20 dark:bg-gray-800 md:border-t-0 md:border-transparent md:!bg-transparent ",children:(0,a.jsx)("form",{onSubmit:w(M),className:"relative mx-4  flex",children:h.a.activeChannel?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("textarea",{id:"createMessageInput",rows:1,className:"create-message-input h-auto max-h-96 w-full resize-none  rounded-xl  bg-gray-100 py-3.5 pl-4 pr-12 text-lg font-semibold text-gray-500  focus:outline-none dark:bg-zinc-600/90 dark:text-zinc-300",...N("content",{required:!0,maxLength:2400,minLength:3}),onInput:e=>{e.currentTarget.style.height="auto",e.currentTarget.style.height="".concat(e.currentTarget.scrollHeight,"px"),u(e.currentTarget.value.length),o>=2400&&e.preventDefault()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w(M)())},onSelect:e=>{let s=e.target.value.slice(e.target.selectionStart,e.target.selectionEnd);t(s),n(e.target.selectionStart),l(e.target.selectionEnd)}}),(0,a.jsx)(D,{selectedText:e,insertMarkdown:P}),(0,a.jsx)(B,{messageAttachmentRecords:v,deleteMessageAttachment:C}),(0,a.jsx)("div",{className:"absolute bottom-[3.75rem] right-2 ",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"  ",children:(0,a.jsxs)(z.ZP,{content:"Upload image",color:"invert",placement:"top",children:[(0,a.jsx)(y.sYB,{size:18,className:"text-gray-300"}),(0,a.jsx)("input",{type:"file",accept:"image/*",className:"absolute left-0 top-0 h-full  w-1 cursor-pointer opacity-0",onChange:U})]})}),(0,a.jsx)(I,{}),(0,a.jsx)(L,{characterCount:o})]})}),(0,a.jsx)("button",{type:"submit",className:"btn-primary absolute bottom-2 right-2 ",children:"Submit"})]}):(0,a.jsx)("div",{className:""})})})},L=e=>{let{characterCount:t}=e;return(0,a.jsxs)("div",{id:"charLimit",className:t<=2400?"text-zinc-300":"text-red-400",children:[t,"/2400"]})},B=e=>{let{messageAttachmentRecords:t,deleteMessageAttachment:s}=e;return t.length?(0,a.jsx)("div",{className:"absolute bottom-14  my-2 flex justify-center space-x-4 rounded bg-zinc-900 p-2 text-gray-300",children:(0,a.jsx)("div",{className:"relative flex space-x-2",children:t.map(e=>(0,a.jsx)("div",{className:"",children:(0,a.jsx)("img",{src:e.url,alt:"Uploaded File Image",className:" h-44 w-44 rounded border-2 border-zinc-900 object-cover"})},e.url))})}):(0,a.jsx)("div",{className:""})},D=e=>{let{selectedText:t,insertMarkdown:s}=e;return t&&(0,a.jsxs)("div",{className:"absolute bottom-14  my-2 flex justify-center space-x-4 rounded bg-zinc-900 p-2 text-gray-300",children:[(0,a.jsx)("button",{type:"button",onClick:()=>s("**","**",t),children:(0,a.jsx)(z.ZP,{content:"Bold",color:"invert",placement:"top",children:(0,a.jsx)(y.PKR,{})})}),(0,a.jsx)("button",{type:"button",onClick:()=>s("*","*",t),children:(0,a.jsx)(z.ZP,{content:"Italic",color:"invert",placement:"top",children:(0,a.jsx)(y.Mef,{})})}),(0,a.jsx)("button",{type:"button",onClick:()=>s("~~","~~",t),children:(0,a.jsx)(z.ZP,{content:"StrikeThrough",color:"invert",placement:"top",children:(0,a.jsx)(y.zal,{})})})]})};var Q=(0,o.Pi)(F),R=s(44080);let q=()=>{let e=(0,c.useRouter)(),t=e.query.id,[s,n]=(0,i.useState)(!1),o=!1,u=async e=>{try{h.a.messages=[],h.a.messageLikes=[[]],await m.b_.getChannelsByServerId(e),await m.lt.getMessagesByChannelId(h.a.activeChannel.id),await m.uy.getMembers(e)}catch(e){d.Z.error(e)}};return(0,i.useEffect)(()=>{let s=h.a.user;if(!s){(0,f.A)("/server/".concat(t)),e.push("/login");return}e.query.id&&!o&&(o=!0,u(t),n(!0))},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r(),{children:[(0,a.jsx)("title",{children:"next-pocket"}),(0,a.jsx)("meta",{name:"description",content:"Generated by create-t3-app"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)(R.u,{appear:!0,show:s,enter:"ease-out duration-700",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-700",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center ",children:(0,a.jsxs)("div",{className:"flex  h-screen w-full  ",children:[(0,a.jsx)(l.Z,{}),(0,a.jsxs)("div",{className:" message-container ",children:[(0,a.jsx)(C,{}),(0,a.jsx)(U.Z,{}),(0,a.jsx)(Q,{})]}),(0,a.jsx)(v,{})]})})})]})};var A=(0,o.Pi)((0,b.Q)((0,b.k)(q)))},72770:function(e){"use strict";e.exports=next}},function(e){e.O(0,[284,71,186,184,774,888,179],function(){return e(e.s=11658)}),_N_E=e.O()}]);